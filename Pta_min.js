var Pta=Pta||{};
Pta.listeners={initialize:function(c){c=document.getElementById(c);Pta.listeners.setTabs(c);c.style.tabSize=4;Pta.listeners.setIndent(c);Pta.listeners.setJoinLines(c);Pta.listeners.setMatching(c);Pta.listeners.setDupChr(c);Pta.listeners.setZen(c);Pta.listeners.setLineNbr(c);Pta.listeners.setMoveCrs(c)},setTabs:function(c){c.addEventListener("keydown",function(d){if(9===d.keyCode&&!d.shiftKey){d.preventDefault();var b,a,f,g;f=c.selectionStart;g=c.selectionEnd;a=c.value;if(f===g)c.value=a.slice(0,f)+
"\t"+a.slice(g),c.selectionStart=f+1,c.selectionEnd=f+1;else{d=a.slice(f,g);var e;b=d;var h=0;for(e=0;e<b.length;e+=1)"\n"===b.charAt(e)&&(h+=1);e=h;if(10!==a.charCodeAt(g-1))for(b=d.length;;){e=c.selectionEnd;f=a.indexOf(d,e);g=f+b;if(0<=f)c.selectionStart=f,c.selectionEnd=g;else if(0<e){c.selectionStart=0;c.selectionEnd=0;continue}return}d=d.replace(/\s+$/g,"");d=d.replace(RegExp("\n","g"),"\n\t");b=a.slice(0,f);a=a.slice(g);c.value=b+"\t"+d+"\n"+a;c.selectionStart=f;c.selectionEnd=g+e}}});c.addEventListener("keydown",
function(d){if(9===d.keyCode&&d.shiftKey){d.preventDefault();var b,a,f;d=c.selectionStart;f=c.selectionEnd;a=c.value;if(d===f)b=a.slice(0,d-1),a=a.slice(d),c.value=b+a,c.selectionStart=d-1,c.selectionEnd=d-1;else{var g=a.slice(d,f),e;b=g;var h=0;for(e=0;e<b.length;e+=1)"\n"===b.charAt(e)&&(h+=1);e=h;32<g.charCodeAt(0)||(g=g.replace(RegExp("\n\t","g"),"\n"),b=a.slice(0,d),a=a.slice(f),c.value=b+g.slice(1)+a,c.selectionStart=d,c.selectionEnd=f-e)}}})},setJoinLines:function(c){c.addEventListener("keydown",
function(d){if("t"===String.fromCharCode(d.which).toLowerCase()&&d.altKey){d.preventDefault();var b,a,f,g;a=c.selectionStart;b=c.selectionEnd;f=c.value;g=f.slice(a,b);""===g?alert("No Lines Selected to Join"):(d=f.slice(0,a),b=f.slice(b),g=g.replace(/\n/g,""),c.value=d+g+b,c.selectionEnd=a)}})},setIndent:function(c){c.addEventListener("keydown",function(d){if(13===d.keyCode&&!d.ctrlKey){d.preventDefault();var b,a,f=c.value,g=c.selectionStart,e=c.selectionEnd;for(d=g-1;0<d&&10!==f.charCodeAt(d);--d);
b=String.fromCharCode(10);0<d&&(d+=1);for(a=f.charCodeAt(d);32===a||9===a;)b+=String.fromCharCode(a),d+=1,a=f.charCodeAt(d);c.value=f.slice(0,g)+b+f.slice(e);c.selectionStart=g+b.length;c.selectionEnd=g+b.length}})},setMatching:function(c){function d(){var f=c.value,d=c.selectionStart,e=f.charAt(d);if(0>"{(".indexOf(e)&&(--d,e=f.charAt(d),0>"})".indexOf(e)))return;"}"===e?b("}","{",d):"{"===e?a("{","}",d):")"===e?b(")","(",d):"("===e&&a("(",")",d)}function b(a,b,e){var d,k=0,l=c.value;for(--e;0<=
e;--e)if(d=l.charAt(e),d===b)if(0===k){c.selectionStart=e;break}else--k;else d===a&&(k+=1);0>e&&alert("Match not found")}function a(a,b,e){var d,k,l=0,m=c.value;k=m.length;for(e+=1;e<k;e+=1)if(d=m.charAt(e),d===b)if(0===l){c.selectionEnd=e+1;break}else--l;else d===a&&(l+=1);e>=k&&alert("Match not found")}c.addEventListener("keydown",function(a){"q"===String.fromCharCode(a.which).toLowerCase()&&a.altKey&&(a.preventDefault(),d())});c.addEventListener("click",function(a){a.ctrlKey&&(a.preventDefault(),
d())})},setDupChr:function(c){c.addEventListener("keydown",function(d){if("d"===String.fromCharCode(d.which).toLowerCase()&&d.altKey){d.preventDefault();var b;d=c.value;var a=c.selectionStart,f=c.selectionEnd,g=0;for(b=a-1;0<b&&(g+=1,10!==d.charCodeAt(b));--b);for(;0<b&&(--b,10!==d.charCodeAt(b)););10!==d.charCodeAt(b)&&--g;b=d.charAt(b+g);c.value=d.slice(0,a)+b+d.slice(f);c.selectionStart=a+1;c.selectionEnd=a+1}})},setZen:function(c){function d(a){var f,d,e,h,k,l;e=c.selectionStart;h=c.selectionEnd;
k=c.value;l=k.slice(e,h);f=k.slice(0,e);d=k.slice(h);e===h?alert("nothing selected"):(0===a?b=e=prompt("Enter tag abbreviation\n or command"):e=b,null!==e&&""!==e&&("/*"===e?(a="/* ",e=" */"):"<!"===e?(a="\x3c!-- ",e=" --\x3e"):"ucase"===e?(e=a="",l=l.toUpperCase()):"lcase"===e?(e=a="",l=l.toLowerCase()):(a="<"+e+">",e="</"+e+">"),k=f+a+l+e+d,c.value=k,c.selectionEnd=k.length-d.length,c.selectionStart=k.length-d.length))}var b="";c.addEventListener("keydown",function(a){if("z"===String.fromCharCode(a.which).toLowerCase()&&
a.altKey){a:{var b,d,e,h,k;h=c.selectionStart;e=c.selectionEnd;b=c.value;k=b.slice(h,e);if(""===k){for(;e<b.length&&!(49>b.charCodeAt(e));)e+=1;for(;0<h;)if(--h,49>b.charCodeAt(h)){h+=1;break}k=b.slice(h,e)}if(""===k)alert("No Key Word to Match");else{d=b.slice(0,h);e=b.slice(e);for(b=0;b<atags.length;b+=1)if(k===atags[b].tag){b=d+atags[b].tagx+e;h=b.indexOf("^",h);-1===h?(c.value=b,c.selectionEnd=b.length-e.length,c.selectionStart=b.length-e.length):(d=b.slice(0,h),e=b.slice(h+1),b=d+e,c.value=b,
c.selectionEnd=h,c.selectionStart=h);break a}b=d+"<"+k+"></"+k+">"+e;h=b.indexOf("><",h);h+=1;c.value=b;c.selectionEnd=h;c.selectionStart=h}}a.preventDefault()}});c.addEventListener("keydown",function(a){"a"===String.fromCharCode(a.which).toLowerCase()&&a.altKey&&(d(0),a.preventDefault())});c.addEventListener("keydown",function(a){"w"===String.fromCharCode(a.which).toLowerCase()&&a.altKey&&(d(1),a.preventDefault())})},setLineNbr:function(c){var d="",b;c.addEventListener("keydown",function(a){if("n"===
String.fromCharCode(a.which).toLowerCase()&&a.altKey)if(a.preventDefault(),""===d){b="1\t\t";a=2;var f,g,e,h=c.value;d=h;for(f=0;f<h.length-1;f+=1)if(g=h.charAt(f),"\n"===g){for(e=a.toString();4>e.length;)e+=" ";b+=g+e+"\t\t";a+=1}else b+=g;c.value=b;c.readOnly=!0}else c.readOnly=!1,c.value=d,d=""})},setMoveCrs:function(c){function d(b){var a,d,g=0;d=c.value;for(a=b;0<=a;a--)if(10===d.charCodeAt(a)){if(a!==b)break}else g+=1;return g}c.addEventListener("keydown",function(b){if("j"===String.fromCharCode(b.which).toLowerCase()&&
b.altKey){b.preventDefault();var a,f;f=c.value;a=c.selectionStart;for(b=d(a);a<f.length&&10!==f.charCodeAt(a);a++);b+=a;for(a++;a<f.length&&10!==f.charCodeAt(a)&&!(a>=b);a++);c.selectionEnd=a;c.selectionStart=a}else if("k"===String.fromCharCode(b.which).toLowerCase()&&b.altKey){b.preventDefault();f=c.value;a=c.selectionStart;10===f.charCodeAt(a)&&a--;for(b=d(a);0<=a&&10!==f.charCodeAt(a);a--);for(a--;0<=a&&10!==f.charCodeAt(a);a--);b+=a;for(a++;a<f.length&&10!==f.charCodeAt(a)&&!(a>=b);a++);c.selectionEnd=
a;c.selectionStart=a}});c.addEventListener("keydown",function(b){if("l"===String.fromCharCode(b.which).toLowerCase()&&b.altKey)b.preventDefault(),b=c.selectionStart-1,0>b&&(b=0),c.selectionEnd=b,c.selectionStart=b;else if(";"===String.fromCharCode(b.which).toLowerCase()&&b.altKey){b.preventDefault();var a;a=c.value;b=c.selectionStart+1;b>=a.length&&(b=a.length-1);c.selectionStart=b;c.selectionEnd=b}})}};
Pta.findr={findText:function(c,d){if(2!==arguments.length)alert("missing arguments for findText");else{var b=document.getElementById(c),a=document.getElementById(d),f;f=a.value.length;var g=b.selectionEnd,a=b.value.indexOf(a.value,g);f=a+f;0<=a?(b.selectionStart=a,b.selectionEnd=f,b.focus()):0<g&&(b.selectionStart=0,b.selectionEnd=0,Pta.findr.findText(c,d))}},replaceOne:function(c,d,b){if(3!==arguments.length)alert("missing arguments for findText");else{var a=document.getElementById(c),f=document.getElementById(b);
Pta.findr.findText(c,d);var g,e,h;h=a.value;g=a.selectionStart;e=a.selectionEnd;g===e?alert("No More to replace"):(g=h.slice(0,g),e=h.slice(e),h=g+f.value+e,a.value=h,a.selectionStart=h.length-e.length,a.selectionEnd=h.length-e.length,a.focus())}},replaceAll:function(c,d,b){if(3!==arguments.length)alert("missing arguments for findText");else{var a=document.getElementById(c),f=document.getElementById(d),g=document.getElementById(b),e=a.value,e=e.replace(new RegExp(f.value,"g"),g.value);a.value=e;a.focus()}}};
Pta.insClip=function(c,d){var b=document.getElementById(c),a=b.value,f=b.selectionStart,g=a.slice(0,f),a=a.slice(f);b.value=g+d+a;b.selectionEnd=f+d.length;b.focus()};
